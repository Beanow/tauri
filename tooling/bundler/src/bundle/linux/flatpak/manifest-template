{
  "app-id": "{{app_id}}",
  "runtime": "org.gnome.Platform",
  "runtime-version": "42",
  "sdk": "org.gnome.Sdk",
  "sdk-extensions": [
    "org.freedesktop.Sdk.Extension.node18",
    "org.freedesktop.Sdk.Extension.rust-stable"
  ],
  "command": "{{main_binary}}",
  "finish-args": [
    "--share=ipc",
    "--socket=x11",
    "--socket=wayland",
    "--socket=pulseaudio",
    "--device=dri",
    "--talk-name=org.freedesktop.Notifications",
    "--talk-name=org.kde.StatusNotifierWatcher",
    "--talk-name=com.canonical.AppMenu.Registrar",
    "--talk-name=com.canonical.indicator.application",
    "--talk-name=com.canonical.Unity.LauncherEntry"
  ],
  "build-options": {
    "append-path": "/usr/lib/sdk/rust-stable/bin:/usr/lib/sdk/node18/bin",
    "build-args": [
      "--share=network"
    ],
    "env": {
      "RUST_BACKTRACE": "1",
      "RUST_LOG": "{{main_binary}}=debug"
    }
  },
  "rename-desktop-file": "{{main_binary}}.desktop",
  "rename-icon": "{{main_binary}}",
  "modules": [
    "shared-modules/libappindicator/libappindicator-gtk3-12.10.json",
    {
      "name": "{{app_id}}",
      "buildsystem": "simple",
      "build-options": {
        "append-path": "/run/cache/cargo/bin",
        "env": {
          "CARGO_HOME": "/run/cache/cargo",
          "YARN_CACHE_FOLDER": "/run/cache/yarn"
        },
        "build-args": [
          "--bind-mount=/run/cache/cargo={{cargo_cache_dir}}",
          "--bind-mount=/run/cache/yarn={{yarn_cache_dir}}",
          "--bind-mount=/run/build/{{app_id}}/{{rel_tauri_dir}}/target={{target_cache_dir}}"
        ]
      },
      "sources": [
        {
          "type": "dir",
          "path": "{{workdir}}",
          "skip": [
            {{#each skip_list}}
            "{{this}}"{{#unless @last}},{{/unless}}
            {{/each}}
          ]
        }
      ],
      "build-commands": [
        "cd {{rel_app_dir}}; yarn preflatpak || exit 0",
        {{#if use_node_cli}}
        "cd {{rel_app_dir}}; yarn; yarn tauri build --verbose --bundles none",
        {{else}}
        "cargo tauri --version || cargo install tauri-cli {{{tauri_cli_version}}}",
        "cd {{rel_app_dir}}; yarn",
        "cd {{rel_tauri_dir}}; cargo tauri build --verbose --bundles none",
        {{/if}}
        {{#each binary}}
        "install -Dm755 {{../rel_project_out_directory}}/{{this}} /app/bin/{{this}}",
        {{/each}}
        "cd {{rel_app_dir}}; yarn postflatpak || exit 0"
      ]
    },
    {
      "name": "generated-assets",
      "buildsystem": "simple",
      "sources": [
        {
          "type": "dir",
          "path": "{{local_dir}}"
        }
      ],
      "build-commands": [
        "cp -r usr/* /app"
      ]
    }
  ]
}
